# B-S期权定价模型

所谓期权，可以拆开成“期”和“权”来看， “期”就是期限、时间，是为未来情形进行的下注，“权”就是权利（买方）、义务（卖方）。  期权就是买方对于未来的可能情形下注，买的一种选择权；而卖方因为承担义务而收钱。  

可以用“保单”的例子来帮助理解， 假设某歌星一个月后要举办演唱会，歌迷怕担心到时黄牛炒票等原因， 提出先预付50元，提前锁定一个月之后能用1000元买到票的权利； 主办方出于资金回笼的需求，并认为1000元的票价合理，希望能提前锁定收益， 同意卖出这个“保单”， 并承担1个月后兑票的责任。 一个月后若门票炒到2000元，则买方就以50元的成本，赚取了1000元的差价；若门票价格跌到500元，则买方就放弃兑票的权利，损失这50元，去买500元的现价票。   这个“保单”就是看涨期权， 50元就是期权价格，1000元就是行权价，1个月后就是到期日。

## 期权价值的组成

自然就引申出了下一个问题，既然期权有价值 — 如何给期权定价？期权的价值如何组成？

**期权价值 = 内在价值+外在价值**

### 内在价值

是指买方立刻行驶权利，能够获得的“实实在在”的收益。

为什么是立刻？ 因为立刻行权则不存在未来的不确定性，也不存在外在价值，此时内在价值就等于期权价值。

另外收益不能是负数，因为买方不会为亏钱的交易行权，若不行权内在价值为0.

- 看涨期权(Call)的内在价值=Max(0, [当前股价-行权价])
- 看跌期权(Put)的内在价值=Max(0, [行权价-当前股价])

### 外在价值

期权价值中除内在价值外的总和， 体现了买方为期权支付的溢价。

核心的有 时间价值(最主要)、波动率价值、机会成本价值。

- 时间价值： 没有剩余时间，一切外在价值都是0，时间越长不确定性越高，因此外在价值越高。（能保一年的“重疾险”没啥价值， 能报30年的“重疾险”很有价值）。
- 波动率价值：波动率越高，代表股价未来上蹿下跳的可能性越大，对于买方来说是好事，因为期权买方“赚无限、亏有限”的不对称收益结构，使得波动率越高，期权的价值越高。
- 机会成本价值：
    - 利率：
        - 对于Call： 相比于直接买正股，买Call可以在到期日之前保留一大笔流动资金，这笔剩下的资金如果投资于无风险资产，产生的利息，也应当体现在外在价值中。无风险利率越高，Call外在价值越高。
        - 对于Put：相比于直接卖正股（可以立即得到现价，可以存入吃利息），买Put的正股还在手里，无法获得利息。所以无风险利率越高，Put外在价值越低。
    - 股息：
        - 对于Call： 有两个视角:(1) 持有正股才能收到股息，持有期权没有。（2）一旦派息除权，股价会下跌，而股价下跌对Call的持有方不利， 降低了行权概率。因此股息越高，Call外在价值越低。
        - 对于Put： 有两个视角：（1）相比于直接卖出正股，持有Put期权仍然能收到股息。(2)  一旦派息除权，股价会下跌，而股价下跌对Put的持有方有利，增加了行权概率。因此股息越高，Put外在价值越高。

## Black-Scholes模型详细解释

在1973年之前，期权定价非常主观，主要凭经验和感觉。后面经济学家Fischer Black和Myron Scholes，提出了B-S模型，为期权提供了一个定价框架，因此获得了1997年诺贝尔经济学奖。

### B-S模型的关键假设

1. 资产价格服从对数正态分布：
2. 在期权有效期内，无风险利率和波动率恒定。
3. 无市场摩擦，不存在税收、交易成本。
4. 期权是欧式期权：只能在到期日行权，不能提前行权。
5. 不存在无风险套利机会
6. 标的资产不支付股息/分红（后续废除）。

### B-S模型的输入变量：

1. **S (Stock Price) - 标的资产现价**: 当前股票（或资产）的市场价格。
2. **K (Strike Price) - 行权价**: 期权合同中约定的未来买入/卖出价。
3. **T (Time to Expiration) - 剩余到期时间**: 距离期权到期还有多久。时间越长，未来的不确定性越大，外在价值通常也越高。 通常在公式中计算时使用 T = DTE/365代替。
4. **r (Risk-Free Rate) - 无风险利率**: 通常参考国债利率，代表了资金的时间成本。
5. **σ (Volatility) - 波动率**: 这是五大因素中**唯一一个无法直接观测、需要预测**的变量。它衡量了资产价格的波动剧烈程度。波动越大，期权未来的可能性就越多，价值也越高。

## B-S 模型的定价公式：

- 看涨期权：C = S×N(d1) - K×e^(-r×T)×N(d2)
- 看跌期权：P = K×e^(-r×T)×N(-d2) - S×N(-d1)

其中：
d1 = [ln(S/K) + (r + σ²/2)×T] / (σ×√T)
d2 = d1 - σ×√T

解释： N()：累积标准正态分布函数，用于查找一个值在正态分布曲线下的概率。 例如N(d)的意思是“在标准正态分布（钟形曲线）下，变量小于d的概率是多少”

![image.png](B-S%E6%9C%9F%E6%9D%83%E5%AE%9A%E4%BB%B7%E6%A8%A1%E5%9E%8B/image.png)

想了解推导过程，可以阅读： [https://wiki.mbalib.com/wiki/Black-Scholes期权定价模型](https://wiki.mbalib.com/wiki/Black-Scholes%E6%9C%9F%E6%9D%83%E5%AE%9A%E4%BB%B7%E6%A8%A1%E5%9E%8B)

### 定价公式解释

对于看跌期权P，分解为两部分：

第一部分： **K×e^(-r×T)×N(-d2)**

- K×e^(-r×T)：行权价的现值（估值=未来现金流折现）,（例子： 500*e^(-0.03*1) = 485, 说明以无风险利率0.03估算，1年后的500元现值应当为485）。
- N(-d2)： 到期日股价低于行权价的概率(**行权概率**)
- **整体含义： 能以行权价卖出的股票现值的数学期望，即期望收益**。

第二部分：**S×N(-d1)**

- S: 当前股价
- N(-d1)：Put的Delta值=N(d1)-1, N(-d1)=1-N(d1), 所以N(-d1)=-Delta。（记得看期权Greeks的含义），即**持有1份期权，对应风险敞口上，约等于持有N(-d1)份股票**。 （例子：600*0.6 = 360，说明当前股价为600， 持有期权相当于放弃360元的股票。）
- 整体含义：若行权，**要放弃的这部分股票的期望成本**。

**P = K×e^(-r×T)×N(-d2) - S×N(-d1)**  ，即看跌期权的定价= **期望收益**（以K行权价卖出股票的现值）**- 期望成本**（未来要放弃的这部分股票的价值）

假设一个Put， K=500, S=600,  r=0.03，T=50/365, σ (IV)=0.25**,**  N(-d2)=0.024,  N(-d1)=0.19

则P = 500* e^(-0.03*50/365)*0.024 - 600*0.19 = 0.55。

对于看涨期权C，分解为两部分：

第一部分：**S×N(d1)** 

- **N(d1)** 是看涨期权的 Delta (Δ) 值。
- **S×N(d1) ： 持有1份期权，对应风险敞口上，约等于持有N(d1)份股票**。
- **直观解释：持有这部分股票的资产价值。**

第二部分：**K*e^(-rT)*N(d2)** 

- **直观解释**: 你只有在S_T>K时，才会去行权并支付行权价K。N(d2)就是这个**“行权概率“**。 K*e^(-rT)是未来行权价对应的折现值。因此第二部分整体是**未来要行权买入这部分股票的现值成本。**

**C =S×N(d1) - K×e^(-r×T)×N(d2)**  ，即看涨期权的定价= **期望收益**（持有的股票价值）**- 期望成本**（为了行权需要准备的资金现值）

假设一个Call， K=650, S=600,  r=0.03，T=50/365,  σ (IV)=0.25**,**  N(d2)=0.192,  N(d1)=0.219

则C = 600*0.22 - 650*e^(-0.03*50/365)*0.19 = 7.11

## B-S模型的优缺点和价值

### B-S模型的假设及其优化

前文有提过，B-S模型的生效依赖于较多的假设前提，其中有相当一部分是不符合真实情况的。

例如： 

1. **核心假设：不考虑标的资产的股息/分红情况。**

假设股票以一个年化的、连续派送的股息率q分红。这就像一个“漏水的漏斗”，股票价值会持续地流失一部分。所有的股票价值S应当替换为S*e^(-qT), 即打了股息率折扣的股票价值作为定价依据。

因此提出**Black-Scholes-Merton Model:**

C = S*e^(-qT) * *N(d1) - K** e^(-rT)*N(d2)

P = *K** e^(-rT)*N(-d2) - S*e^(-qT) * *N(-d1)*

即股息对于Call是负面的，对于Put是正面的。

这也比较好理解，对于Long Call的持有方，看多但是没持有正股， 派息收益享受不到，且派息后股价要下跌，会造成账面亏损。  对于Long Put的持有方，看空但是没卖出正股，派息收益可享受，且排序后股价下跌， 账面还会盈利。

1. **核心假设：价格服从对数正态分布。**

实际情况： 肥尾分布， 即极端事件的发生概率会大于正态分布预计，且暴跌概率大于暴涨。

![image.png](B-S%E6%9C%9F%E6%9D%83%E5%AE%9A%E4%BB%B7%E6%A8%A1%E5%9E%8B/image%201.png)

改良方案：**Merton跳跃-扩散模型**。它在原本的对数正态扩散过程上，增加了一个泊松跳跃过程。模型需要额外假设跳跃的频率、平均跳跃幅度和跳跃的波动性。

**结果：**能更好地捕捉“肥尾”现象，对极端事件的定价更准确

1. **核心假设：波动率恒定**
    
    实际情况：波动率微笑。即IV: 虚值期权>实值期权>平值期权。即市场上对于低概率“黑天鹅”事件，会给出更多的波动率溢价。 即给防范极端事件的“保单”倾向于给更高的“保费”。
    
    ![image.png](B-S%E6%9C%9F%E6%9D%83%E5%AE%9A%E4%BB%B7%E6%A8%A1%E5%9E%8B/image%202.png)
    

改良方案：**Heston模型**。它假设波动率本身也是一个随机变量，有自己的随机过程（例如均值回归，即波动率高了会倾向于下降，低了会倾向于上升）。

**结果：**这类模型没有简单的“公式解”，通常需要用复杂的数值方法（如蒙特卡洛模拟）求解。但它能很好地解释“波动率微笑”现象。

### 既然已有交易所的groundTruth期权数据，那么理论定价的偏差大吗？ 大的原因是什么？

对，实际上通过B-S模型计算的理论期权定价和实际交易所报价是存在偏差的。

经过研究统计，偏差程度：

- **平值长期期权**：偏差2-8%（相对较小）
- **虚值/实值期权**：偏差10-30%（显著偏差）
- **短期期权**：偏差5-15%（中等偏差）

偏差造成的最主要原因就是“**波动率 σ 不是一个常数**”,  而实际的市场隐含波动率IV呈现“微笑”形状。

IV是通过B-S模型，把真实期权成交价当已知量，把 **σ** 当作未知量，反推算出的。它体现了市场一致给出的预期波动率情况， 结果与Moneyness呈现明显“微笑”形状， 即说明市场对于防范极端事件，倾向于支付更高保费的心理。

### 如果B-S定价模型定价不准，那还有意义吗？

当然有意义。

主要体现在两方面：捕捉交易机会、 计算监测风险敞口。

1. **计算隐含波动率IV，并根据IV判断交易机会。**

交易员把期权的市场真实价格 C/P、S、K、T、r 输入公式，反解出那个唯一的未知数 σ。这个被市场价格“内涵”的波动率，就是**隐含波动率**。

IV成了期权的真正“价格标签”。这使得不同行权价，不同到期日的期权有了统一的衡量标准。 交易的核心编程对波动率的预测。 如果认为现在IV偏低，则应该买入期权，因为便宜；如果认为现在IV偏高，则应该卖出期权，因为贵。

1. **计算和管理风险（“希腊字母” The Greeks）**

当期权确定后，它的利润来源和风险敞口就确定了，可以通过B-S模型计算各种Greeks的数值。

例如Delta、Theta、Vega、Gamma。 它们相当于行驶过程中的仪表盘，告诉交易员每个风险敞口有多大，及时预警和调整。