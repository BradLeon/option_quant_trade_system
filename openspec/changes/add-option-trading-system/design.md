## Context

这是一个从零开始的期权量化交易系统。用户希望实现自动化的期权卖方策略，涵盖筛选、监控、交易、回测和复盘的完整流程。

**关键利益相关者：**
- 个人投资者（用户本人）
- 系统维护者（用户本人）

**约束条件：**
- 使用富途 OpenAPI 作为数据源（需要牛牛账户）
- 遵循 QuantConnect LEAN 框架的设计模式
- 仅支持期权卖方策略

## Goals / Non-Goals

### Goals
- 实现 Short Put、Covered Call 和轮动策略的自动化筛选
- 提供实时持仓监控和风险预警
- 支持历史数据回测验证策略
- 自动推送交易信号到用户设备
- 记录实盘交易并生成绩效报告

### Non-Goals
- 不实现期权买方策略（暂不支持）
- 不实现全自动下单（仅信号推送，手动执行）
- 不支持高频交易场景
- 不支持多用户/商业化部署

## Decisions

### D1: 四层架构设计

**决定：** 采用分层架构（数据层→引擎层→业务层→展示层）

**原因：**
- 职责清晰，便于独立开发和测试
- 支持未来扩展（如更换数据源、新增策略）
- 符合 QuantConnect 的模块化设计理念

**替代方案：**
- 单体应用：开发快但难以维护和扩展
- 微服务：过度设计，个人项目无需

### D2: 数据源选择

**决定：** 使用富途 OpenAPI 作为主数据源

**原因：**
- 用户已有富途账户
- 支持港股、美股期权数据
- 提供 Python SDK，集成成本低
- 交易无额外费用

**替代方案：**
- Interactive Brokers API：功能更全但配置复杂
- Yahoo Finance：免费但期权数据有限
- 自建数据源：成本高，维护难

### D3: 策略框架选择

**决定：** 基于 QuantConnect LEAN 框架开发策略

**原因：**
- 用户已安装 LEAN
- 提供完整的回测基础设施
- 内置期权 Greeks 计算
- 支持 Python，降低开发门槛

**权衡：**
- LEAN 主要面向云端运行，本地部署需要额外配置
- 需要适配富途数据格式到 LEAN 数据结构

### D4: 信号推送方式

**决定：** 优先支持微信（Server酱/WxPusher），可选邮件和 Telegram

**原因：**
- 微信是国内用户最常用的即时通讯
- Server酱/WxPusher 有免费额度
- 预留扩展接口支持其他渠道

### D5: Web 框架选择

**决定：** 使用 Streamlit 构建仪表盘

**原因：**
- Python 原生，无需前端知识
- 快速原型开发
- 内置图表和交互组件
- 适合单用户场景

**替代方案：**
- Dash：功能更强但学习曲线陡
- Flask + React：全栈开发成本高

## Risks / Trade-offs

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 富途 API 限流 | 数据获取受阻 | 实现本地缓存，减少 API 调用 |
| OpenD 连接不稳定 | 实时数据中断 | 心跳检测 + 自动重连机制 |
| LEAN 本地配置复杂 | 回测功能受限 | 优先实现简化版回测，LEAN 作为可选 |
| 信号延迟 | 错过最佳交易时机 | 设置多通道推送，确保至少一个通道可用 |

## Migration Plan

N/A - 新项目，无需迁移

## Open Questions

1. **持仓数据存储**：使用 SQLite 还是 PostgreSQL？
   - 建议：先用 SQLite，规模增长后迁移

2. **回测数据来源**：富途历史数据是否足够？需要补充其他数据源吗？
   - 待用户确认数据需求范围

3. **展示层优先级**：先做 Web 仪表盘还是先做信号推送？
   - 建议：先做信号推送（核心价值），再做仪表盘

4. **自动交易**：未来是否考虑全自动下单？
   - 当前设计为手动执行，预留自动化接口
