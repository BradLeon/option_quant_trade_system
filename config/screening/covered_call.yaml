# Covered Call 策略筛选配置
# 持股卖出看涨期权策略
#
# 配置模式:
# - LIVE: 使用下方主配置 (严格的生产环境值)
# - BACKTEST: 自动合并 backtest_overrides (放宽参数)

market_filter:
  # 美股市场指标
  us_market:
    vix_symbol: "^VIX"
    vix_range: [12, 25]           # VIX 适宜区间（比 Short Put 略低）
    vix_percentile_range: [0.2, 0.7]
    vix3m_symbol: "^VIX3M"
    term_structure_threshold: 0.95
    trend_indices:
      - symbol: "SPY"
        weight: 0.6
      - symbol: "QQQ"
        weight: 0.4
    trend_required: "neutral_or_bearish"  # 中性或温和看跌更适合 Covered Call
    pcr_symbol: "SPY"
    pcr_range: [0.6, 1.0]

  # 港股市场指标
  hk_market:
    volatility_source: "2800.HK"
    iv_calculation: "atm_weighted"
    iv_range: [15, 28]
    iv_percentile_range: [0.2, 0.7]
    trend_indices:
      - symbol: "2800.HK"
        weight: 0.5
      - symbol: "3033.HK"
        weight: 0.5
    trend_required: "neutral_or_bearish"

underlying_filter:
  min_iv_rank: 10                 # 最低 IV Rank (基准值)
  trend_override:                 # 根据市场趋势调整 IV Rank 阈值
    bearish:
      min_iv_rank: 15             # 熊市顺势：适度放宽
    bullish:
      min_iv_rank: 40             # 牛市逆势：收紧，只卖贵的
  max_iv_hv_ratio: 1.8
  min_iv_hv_ratio: 0.9
  technical:
    min_rsi: 45                   # RSI 下限
    max_rsi: 75                   # RSI 上限（动能衰竭区间）
    rsi_exhaustion_range: [40, 70]   # 动能衰竭区间
    bb_percent_b_range: [0.7, 0.9]   # 布林带 %B 动能衰竭区间
    max_adx: 40
    min_sma_alignment: "neutral"
  fundamental:
    enabled: false
    max_pe_percentile: 0.8
    min_recommendation: "hold"

contract_filter:
  metrics:
    min_expected_roc: 0.10      # P0: 年化期望收益率 ≥ 10%
    min_tgr: 0.50               # 放宽 TGR 阈值

 
# ============================================================
# 回测模式覆盖 (仅在 BACKTEST 模式下生效)
# 这些值会覆盖上面的主配置
# ============================================================
backtest_overrides:
  market_filter:
    us_market:
      vix_range: [0, 999]              # 禁用 VIX 范围过滤
      vix_percentile_range: [0.0, 1.0] # 禁用 VIX percentile 过滤
      term_structure_threshold: 999    # 禁用期限结构过滤
  underlying_filter:
    max_iv_hv_ratio: 3.0          # 放宽 IV/HV 上限 (回测数据可能有偏差)
  contract_filter:
    liquidity:
      min_open_interest: 0        # 回测数据可能无 OI
      max_bid_ask_spread: 0.30    # 放宽 spread 限制
    metrics:
      min_expected_roc: 0.01        # 最低预期收益率 (LIVE: 10%)
      min_tgr: 0.20                 # 最低 TGR 阈值 (LIVE: 50%)