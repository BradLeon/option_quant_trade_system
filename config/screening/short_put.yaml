# Short Put 策略筛选配置
# 卖出看跌期权策略
#
# 配置模式:
# - LIVE: 使用下方主配置 (严格的生产环境值)
# - BACKTEST: 自动合并 backtest_overrides (放宽参数)

market_filter:
  # 美股市场指标
  us_market:
    vix_symbol: "^VIX"
    vix_range: [15, 28]           # VIX 适宜区间
    vix_percentile_range: [0.2, 0.8]
    vix3m_symbol: "^VIX3M"
    term_structure_threshold: 0.9  # VIX/VIX3M < 0.9 为正向结构
    trend_indices:
      - symbol: "SPY"
        weight: 0.6
      - symbol: "QQQ"
        weight: 0.4
    trend_required: "bullish_or_neutral"
    pcr_symbol: "SPY"
    pcr_range: [0.8, 1.2]

  # 港股市场指标
  hk_market:
    volatility_source: "2800.HK"
    iv_calculation: "atm_weighted"
    iv_range: [18, 32]
    iv_percentile_range: [0.3, 0.8]
    trend_indices:
      - symbol: "2800.HK"
        weight: 0.5
      - symbol: "3033.HK"
        weight: 0.5
    trend_required: "bullish_or_neutral"

underlying_filter:
  min_iv_rank: 10                 # 最低 IV Rank (基准值)
  trend_override:                 # 根据市场趋势调整 IV Rank 阈值
    bullish:
      min_iv_rank: 15             # 牛市顺势：适度放宽
    bearish:
      min_iv_rank: 40             # 熊市逆势：收紧，只卖贵的
  max_iv_hv_ratio: 1.5            # IV/HV 上限 (LIVE: 严格)
  min_iv_hv_ratio: 0.8            # IV/HV 下限
  technical:
    min_rsi: 30                   # RSI 下限（避免接飞刀）
    max_rsi: 70                   # RSI 上限
    rsi_stabilizing_range: [30, 45]  # 企稳区间
    bb_percent_b_range: [0.1, 0.3]   # 布林带 %B 企稳区间
    max_adx: 45                   # ADX 上限（避免强趋势）
    min_sma_alignment: "neutral"  # MA 排列要求
  fundamental:
    enabled: false                # 是否启用基本面筛选
    max_pe_percentile: 0.7        # PE 历史百分位上限
    min_recommendation: "hold"    # 最低分析师评级

contract_filter:
  liquidity:
    min_open_interest: 100        # 最低持仓量 (LIVE)
    max_bid_ask_spread: 0.10      # 最大买卖价差 (LIVE: 严格)
  metrics:
    min_expected_roc: 0.10        # 最低预期收益率 (LIVE: 10%)
    min_tgr: 0.50                 # 最低 TGR 阈值 (LIVE: 50%)

# ============================================================
# 回测模式覆盖 (仅在 BACKTEST 模式下生效)
# 这些值会覆盖上面的主配置
# ============================================================
backtest_overrides:
  market_filter:
    us_market:
      vix_range: [0, 999]              # 禁用 VIX 范围过滤
      vix_percentile_range: [0.0, 1.0] # 禁用 VIX percentile 过滤
      term_structure_threshold: 999    # 禁用期限结构过滤
  underlying_filter:
    min_iv_rank: 0                # 禁用 IV Rank 过滤
    max_iv_hv_ratio: 3.0          # 放宽 IV/HV 上限 (回测数据可能有偏差)
  contract_filter:
    liquidity:
      min_open_interest: 0        # 回测数据可能无 OI
      max_bid_ask_spread: 0.30    # 放宽 spread 限制
    metrics:
      min_expected_roc: -0.5        # 最低预期收益率 (LIVE: 10%)
      min_tgr: 0.0                 # 最低 TGR 阈值 (LIVE: 50%)